<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Call Processing · SquareDanceReasoning.jl</title><meta name="title" content="Call Processing · SquareDanceReasoning.jl"/><meta property="og:title" content="Call Processing · SquareDanceReasoning.jl"/><meta property="twitter:title" content="Call Processing · SquareDanceReasoning.jl"/><meta name="description" content="Documentation for SquareDanceReasoning.jl."/><meta property="og:description" content="Documentation for SquareDanceReasoning.jl."/><meta property="twitter:description" content="Documentation for SquareDanceReasoning.jl."/><meta property="og:url" content="https://MarkNahabedian.github.io/SquareDanceReasoning.jl/call_processing.html"/><meta property="twitter:url" content="https://MarkNahabedian.github.io/SquareDanceReasoning.jl/call_processing.html"/><link rel="canonical" href="https://MarkNahabedian.github.io/SquareDanceReasoning.jl/call_processing.html"/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">SquareDanceReasoning.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Home</a></li><li><a class="tocitem" href="coordinate_system.html">Coordinate System</a></li><li><a class="tocitem" href="dancers.html">Dancers, Their Positions and Directions</a></li><li><span class="tocitem">Formations</span><ul><li><a class="tocitem" href="formations.html">Overview</a></li><li><a class="tocitem" href="formation_hierarchy.html">Supported Formations</a></li><li><a class="tocitem" href="formation_drawings/index.html">Formation Drawings</a></li></ul></li><li><a class="tocitem" href="rule_hierarchy.html">Rule Hierarchy</a></li><li><a class="tocitem" href="motion_primitives.html">Motion Primitives</a></li><li><span class="tocitem">Square Dance Calls</span><ul><li class="is-active"><a class="tocitem" href="call_processing.html">Call Processing</a><ul class="internal"><li><a class="tocitem" href="#Processing-a-Square-Dance-Call"><span>Processing a Square Dance Call</span></a></li></ul></li><li><a class="tocitem" href="supported_square_dance_calls.html">Supported Square Dance Calls</a></li><li><a class="tocitem" href="Showcase/showcase.html">Choreograpy Showcase</a></li></ul></li><li><a class="tocitem" href="doc_index.html">Index</a></li><li><a class="tocitem" href="definitions.html">Definitions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Square Dance Calls</a></li><li class="is-active"><a href="call_processing.html">Call Processing</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="call_processing.html">Call Processing</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/MarkNahabedian/SquareDanceReasoning.jl/blob/main/docs/src/call_processing.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="Processing-a-Square-Dance-Call"><a class="docs-heading-anchor" href="#Processing-a-Square-Dance-Call">Processing a Square Dance Call</a><a id="Processing-a-Square-Dance-Call-1"></a><a class="docs-heading-anchor-permalink" href="#Processing-a-Square-Dance-Call" title="Permalink"></a></h2><p>Every square dance call is represented by an instance of a subtype of <a href="definitions.html#SquareDanceReasoning.SquareDanceCall">`SquareDanceCall</a><code>.  Every instance has a [</code>role<code>](@ref)</code> field which can be used to restrict the call to only some dancers, for example <code>OriginalHead</code> or <code>Center</code>.  Some calls might have additional fields that inform a handedness (e.g. <a href="definitions.html#SquareDanceReasoning.PullBy"><code>PullBy</code></a>) or a count (<a href="definitions.html#SquareDanceReasoning.SquareThru"><code>SquareThru</code></a>).</p><p>The function <a href="definitions.html#SquareDanceReasoning.do_call-Tuple{ReteRootNode, SquareDanceCall}"><code>do_call</code></a> is the entry point for performing a square dance call.  It is passed the current knowledge base (a ReteRootNode) and the call to be performed.  The knowledge base already knows the current location and facing direction of each dancer, and has concluded all of the formations they are in.</p><p><code>do_call</code> creates a <a href="definitions.html#SquareDanceReasoning.CallSchedule"><code>CallSchedule</code></a> and schedules the call to that schedule. <code>do_call</code> then calls <code>do_schedule</code>, passing it the schedule and the knowledge base.</p><p><code>do_schedule</code> dequeues calls from the schedule.  It calls [<code>get_call_options</code>] to identify formations in the knowledge base that match the call&#39;s <code>role</code> filed and the result of calling <a href="definitions.html#SquareDanceReasoning.can_do_from-Tuple{SquareDanceCall, SquareDanceFormation}"><code>can_do_from</code></a>.  <code>do_schedule</code> calls <a href="definitions.html#SquareDanceReasoning.expand_parts-Tuple{SquareDanceCall, SquareDanceFormation}"><code>expand_parts</code></a> with the call and the appropriate formation.  If there is an expansion, those parts are placed in the schedule.  Otherwise <a href="definitions.html#SquareDanceReasoning.perform"><code>perform</code></a> is called to perform the call.</p><p>There is a method of <a href="definitions.html#SquareDanceReasoning.can_do_from-Tuple{SquareDanceCall, SquareDanceFormation}"><code>can_do_from</code></a> for each combination of square dance call and formation.  <code>can_do_from</code> returns a preference number that imposes a preference order on each combination of call and formation.  A preference value of <code>0</code> indicates that the call can not be performed from that formation (or that it is not yet implemented). A positive preference value is returned if the call can be performed from that formation.  A higher preference value is preferred over a lower one.  For example, <code>UTurnBack</code> from <code>Couple</code> is preferable to <code>UTurnBack</code> from a single dancer (represented as a <code>DancerState</code>) because <code>Couple</code> furter informs correct turning direction.  A call like <code>AndRoll</code> need only be implemented for a single dancer (<code>DancerState</code>) because the dancer&#39;s rotational flow can be determined from there (via the <code>previous</code> chain).</p><p><code>get_call_options</code> is pretty complicated.  Consider a right handed tidal wave (<a href="definitions.html#SquareDanceReasoning.RHWaveOfEight"><code>RHWaveOfEight</code></a>).  it includes <code>7</code> two dancer formations: four <a href="definitions.html#SquareDanceReasoning.RHMiniWave"><code>RHMiniWave</code></a>s and three <a href="definitions.html#SquareDanceReasoning.LHMiniWave"><code>LHMiniWave</code></a>s.  If there is only one <code>CanDoCall</code> concerning a dancer after the preference sorting, then that <code>CanDoCall</code> will be included in the results of <code>get_call_options</code>.  Any <code>CanDoCall</code> whose formation includes a dancer that is already included in the result set is discarded.  <code>get_call_options</code> loops over these two operations: adding to the result set and eliminating overlaps, until all <code>CanDoCall</code> objects have been considered.  <code>get_call_options</code> finally returns those results – a vector of <code>CanDoCall</code> objects that concern disjoint formations.</p><p>Once <code>do_schedule</code> has processed all of the schedule entries for a given time value, it calls <a href="definitions.html#SquareDanceReasoning.breathe-Tuple{Vector{TwoDancerFormation}, Vector{DancerState}}">`breathe</a><code>to spread dancers apart if any overlap.</code>do<em>schedule<code>then makes sure the dancers are all synchronized and updates the knowledge base (actually, it creates and populates a new one because the Rete package doesn&#39;t support retraction).  If the schedule is not yet empty then</code>do</em>schedule` continues as above.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="motion_primitives.html">« Motion Primitives</a><a class="docs-footer-nextpage" href="supported_square_dance_calls.html">Supported Square Dance Calls »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Thursday 31 October 2024 12:13">Thursday 31 October 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
